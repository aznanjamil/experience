/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */
import{r as e,h as i,H as s,g as t}from"./p-db9a72ae.js";import{i as a,a5 as n}from"./p-9bad2661.js";import{u as r,c as o}from"./p-6206debe.js";const c=class{constructor(i){e(this,i),this.manager=r(this),this._watchHandles=[],this.label=void 0,this.position="top-right",this.view=void 0,this.messages=this.manager.readonly(o({blocking:!0})),this.state=void 0}positionWatcher(e){void 0!==e&&this.viewModel&&this.view.ui.move(this.el,e)}async componentDidLoad(){const{watch:e}=await a();this._watchHandles.push(e((()=>this.viewModel.state),(e=>{this.state=e})))}async componentWillLoad(){await this._checkForView(),this.viewModel=await n({view:this.view}),this.label=this.label?this.label:this.messages.label}disconnectedCallback(){this._watchHandles.forEach((e=>{e.remove()})),this._watchHandles=[]}render(){const{messages:e,label:t,viewModel:a,viewModel:{state:n,loadError:r}}=this,o=Array.from(this.viewModel.serviceNameLookup,(([e,i])=>({url:e,name:i})));return i(s,null,i("calcite-flow",{ref:e=>{this.flowElement=e},class:"flow-main"},i("calcite-flow-item",{heading:t},i("calcite-panel",{class:"panel-services",loading:"loading"===n},o.map((s=>i("arcgis-version-management-service-item",{flowElement:this.flowElement,heading:t,serviceUrl:s.url,strings:e,viewModel:a,onVersionItemActionClickedEventWithServiceUrl:e=>{this.flowElement&&this._handleVersionItemActionClick(e,this.flowElement)},onVersionListActionClickedEvent:e=>{this.flowElement&&this._handleVersionListActionClick(e,this.flowElement)}}))),"disabled"===n?i("calcite-notice",{class:"notice",closable:!1,kind:"warning",open:!0,scale:"s",slot:"footer"},i("div",{slot:"message"},this._getLoadError(r))):void 0))))}async _checkForView(){const e=this.el.closest("arcgis-map");e?.view&&(await e.view.map.load(),this.view=e.view,this.view.ui.add(this.el,this.position))}_createVersionPropertiesFlow(e,i){const{flowElement:s,viewModel:t}=this;if(!s)return null;const a=document.createElement("arcgis-version-management-version-properties");return a.flowElement=s,a.serviceUrl=e,a.strings=this.messages,a.versionInfo=i,a.viewModel=t,a.addEventListener("versionPropertiesSaveClickedEvent",(async e=>{const{serviceUrl:i,versionInfo:a}=e.detail,n=a.versionIdentifier.name,r=n.split(".").length>1?n.split(".")[1]:n,o=n.split(".").length>1?n.split(".")[0]:t.userLookup.get(i);if(""===a.versionIdentifier.guid?await t.createVersion({access:a.access,description:a.description,featureServerUrl:i,ownerName:o,versionName:r}):await t.alterVersion({access:a.access,description:a.description,featureServerUrl:i,ownerName:o,versionIdentifier:{name:"",guid:a.versionIdentifier.guid},versionName:r}),"ready"===t.state){const e=s.getElementsByTagName("arcgis-version-management-version-list")[0];e.versionInfos=[];const a=await t.getVersionInfos(i,!0);e.versionInfos=a,await s.back()}})),a}_getLoadError(e){const{messages:i}=this;switch(e){case"no-feature-services":return i.loadErrors.noFeatureServices;case"no-layers-property":return i.loadErrors.noLayersProperty;default:return e}}async _handleVersionItemActionClick(e,i){const{actionType:s,serviceUrl:t,versionInfo:a}=e.detail;switch(s){case"changeVersion":await this._switchToVersion(t,a.versionIdentifier.name,a.versionIdentifier.guid);break;case"editVersion":{const e=this._createVersionPropertiesFlow(t,a);e&&i.append(e);break}}}async _handleVersionListActionClick(e,i){const{actionType:s,serviceUrl:t}=e.detail;switch(s){case"newVersion":{const e=this._createVersionPropertiesFlow(t,void 0);e&&i.append(e);break}case"refreshVersions":if(this.flowElement){const e=this.flowElement.getElementsByTagName("arcgis-version-management-version-list")[0];e.versionInfos=[];const i=await this.viewModel.getVersionInfos(t,!0);e.versionInfos=i}}}async _switchToVersion(e,i,s){await this.viewModel.changeVersion(e,i,s)}static get assetsDirs(){return["assets"]}get el(){return t(this)}static get watchers(){return{position:["positionWatcher"]}}};c.style=".div-content{background-color:var(--calcite-ui-foreground-1);padding:0.75rem}.flow-main{width:330px}.notice{width:-webkit-fill-available}.panel-services{max-height:400px}.panel-versions{max-height:400px}";export{c as arcgis_version_management}