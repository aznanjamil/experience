/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */
import{h as t,r as s,c as i,g as e}from"./p-db9a72ae.js";import{k as o,i as h}from"./p-9bad2661.js";import{p as n,A as r,a as c,u as a,l,b as f}from"./p-6206debe.js";import{k as p}from"./p-a847694c.js";import{c as d,r as b}from"./p-6f9e9741.js";const u=n(class extends r{constructor(t,s){super(t,s),this._watchedViewModelProperties=new Set,this._watchedVisibleElementsProperties={},Object.defineProperty(this.exports,"viewModel",{value:c.makeGetterProxy(t,this._watchedViewModelProperties)}),Object.defineProperty(this.exports,"visibleElements",{value:this._makeVisibleElementsBinder()})}hostConnected(){this.component.manager.didLoadCalled&&d(this.component)}async hostLoad(){this.component.render=()=>t("div",null),this._watchedProperties.delete("viewModel"),await super.hostLoad(),this._watchMetaProperties(),this._reEmitWidgetEvents(),this.onLifecycle((()=>this.reactiveUtils.watch((()=>this._instance.viewModel),(t=>{this.component.viewModel=t}),{initial:!0})));const s=this._instance.viewModel;if("object"==typeof s){c.watchComponentUpdates(this,s,this._watchedViewModelProperties),c.watchAccessorUpdates(this,s,this._watchedViewModelProperties);const t=c.gatherParameters(this,this._watchedViewModelProperties);s.set(t)}else if(this._watchedViewModelProperties.size>0)throw new Error(`The widget does not have a viewModel to bind to. Tried to bind the following properties: ${Array.from(this._watchedViewModelProperties).join(", ")}`);const i=Object.entries(this._watchedVisibleElementsProperties);i.length>0&&this.onLifecycle((()=>i.map((([t,s])=>{let i,e=this._instance.visibleElements??{};for(const t of s.slice(0,-1)){if("object"!=typeof e[t]||null===e[t]){i=Boolean(e[t]);break}e=e[t]}void 0===i&&(i=Boolean(e[s.slice(-1)[0]]??!0)),t.startsWith("hide");const o=t.startsWith("hide")||t.startsWith("show")?t.startsWith("hide"):i,h=this.component;return"boolean"==typeof h[t]?this._updateWidgetVisibleElement(s,h[t],o):h[t]=!1,this.watch(t,(t=>this._updateWidgetVisibleElement(s,t,o)))}))))}_updateWidgetVisibleElement(t,s,i){let e=this._instance.visibleElements??{};for(const s of t.slice(0,-1))"object"==typeof e[s]&&null!==e[s]||(e[s]={}),e=e[s];const o=Boolean(i?!s:s);e[t.at(-1)]=o}hostLoaded(){const{el:t}=this.component;t.childElem=t.shadowRoot?.firstChild??t.firstChild??void 0??t.childElem,this.component.childElem=t.childElem,this._instance.container=this.component.childElem??this.component.el,"view"in this.component||Object.defineProperty(this.component,"view",{get:()=>this._instance.view??this._instance.viewModel?.view,set:t=>{"view"in this._instance||"object"!=typeof this._instance.viewModel?this._instance.view=t:this._instance.viewModel.view=t}}),d(this.component),this.component.arcgisReady.emit()}_watchMetaProperties(){this.watch("position",(t=>{null!=this.component.childElem&&"string"==typeof t&&this.component.view?.ui.move(this.component.childElem,t)})),this.watch("referenceElement",(t=>{b(this.component,t).catch(console.error)}))}_reEmitWidgetEvents(){if(!("on"in this._instance)||"function"!=typeof this._instance.on)return;const t=this._instance;Object.entries(this.component).forEach((([s,i])=>{const e=i;if(!s.startsWith("widget")||"widget"===s||"object"!=typeof e||null===e||!("emit"in e)||"function"!=typeof e.emit)return;const o=e.emit,h=s.slice(6),n=p(h),r=`${n[0].toLowerCase()}${n.slice(1)}`;this.onLifecycle((()=>this.reactiveUtils.on((()=>t),r,o)))}))}hostDisconnected(){"object"==typeof this.component.childElem&&this.component.view?.ui.remove(this.component.childElem)}_makeVisibleElementsBinder(){return new Proxy({},{has:(t,s)=>"string"==typeof s||Reflect.has(t,s),get:(t,s)=>{if("symbol"==typeof s||s in Promise.prototype)return Reflect.get(t,s);const i=[s],e=this._makeRecursiveProxy(i);return this.component.manager.trackPropKey((t=>{if(void 0===t)throw new Error("Unable to bind visibleElements property. Check for incorrect this.widget.visibleElements usage");this.component[t]=!1,this._watchedVisibleElementsProperties[t]=i}),e,!0)}})}_makeRecursiveProxy(t){const s=new Proxy({},{get:(i,e)=>{const o=Reflect.get(i,e);return"symbol"==typeof e||e in Promise.prototype?o:(t.push(e),s)}});return s}}),m=(y=o,t=>u(t,y));var y;const v=class{constructor(t){s(this,t),this.arcgisReady=i(this,"arcgisReady",7),this.arcgisPropertyChange=i(this,"arcgisPropertyChange",7),this.manager=a(this),this.reactiveUtils=l(h),this.widget=m(this),this.viewModel=this.widget.viewModel,this.arcgisPropertyChange=f()("orientation"),this.icon=this.widget.icon,this.label=this.widget.label,this.orientation=this.manager.getSet(this.viewModel.orientation,{set:(t,s)=>{return(i=t??{}).z===(e=s??{}).z&&i.y===e.y&&i.x===e.x?s:t;var i,e}}),this.position="bottom-left",this.referenceElement=void 0,this.state=this.viewModel.state}async reset(){this.widget.reset()}get el(){return e(this)}};v.style="";export{v as arcgis_compass}